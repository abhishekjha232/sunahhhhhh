<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sunahh</title>
    
    <!-- PWA / Native App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sunahh">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">

    <!-- Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:italic,wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            margin: 0;
            padding: 0;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none;
        }

        .font-serif { font-family: 'Playfair Display', serif; }

        /* Smooth Transitions */
        .view-transition {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pulse Animation */
        @keyframes heartPulse {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        .animate-heart {
            animation: heartPulse 0.8s ease-in-out infinite;
        }

        /* Hide Scrollbars */
        ::-webkit-scrollbar { display: none; }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Loading Spinner */
        .loader {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, query, orderBy, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        // Global Firebase handles
        window.fb = { initializeApp, getFirestore, doc, setDoc, onSnapshot, collection, addDoc, query, orderBy, serverTimestamp, updateDoc, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Custom SVG Components ---
        const Icon = ({ name, size = 24, className = "", fill = "none" }) => {
            const icons = {
                Heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />,
                MessageCircle: <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />,
                Cloud: <path d="M17.5 19c3.037 0 5.5-2.463 5.5-5.5 0-2.812-2.112-5.132-4.832-5.447C17.712 5.093 15.088 3 12 3c-2.73 0-5.074 1.637-6.095 4.02C3.393 7.545 1.5 9.551 1.5 12c0 2.761 2.239 5 5 5h11Z" />,
                Send: <><path d="m22 2-7 20-4-9-9-4Z" /><line x1="22" x2="11" y1="2" y2="13" /></>,
                Sparkles: <><path d="m12 3 1.912 5.813a2 2 0 0 1 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 1-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 1-1.275-1.275L3 12l5.813-1.912a2 2 0 0 1 1.275-1.275L12 3Z" /></>,
                MapPin: <><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></>,
                Clock: <><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></>,
                Smile: <><circle cx="12" cy="12" r="10" /><path d="M8 14s1.5 2 4 2 4-2 4-2" /><line x1="9" x2="9.01" y1="9" y2="9" /><line x1="15" x2="15.01" y1="9" y2="9" /></>,
                Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
                Volume2: <><path d="M11 5 6 9H2v6h4l5 4V5Z" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /></>,
                Wand2: <><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.21 1.21 0 0 0 1.72 0L21.64 5.36a1.21 1.21 0 0 0 0-1.72Z" /><path d="m14 7 3 3" /><path d="M5 6v4" /><path d="M19 14v4" /><path d="M10 2v2" /><path d="M7 8H3" /><path d="M21 16h-4" /><path d="M11 3H9" /></>,
                CalendarHeart: <><path d="M21 10V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h7" /><path d="M16 2v4" /><path d="M8 2v4" /><path d="M3 10h18" /><path d="M21.2 13.1a2.4 2.4 0 0 0-3.4 0l-.8.8-.8-.8a2.4 2.4 0 0 0-3.4 3.4l4.2 4.2 4.2-4.2a2.4 2.4 0 0 0 0-3.4Z" /></>,
                Smartphone: <><rect width="14" height="20" x="5" y="2" rx="2" ry="2" /><line x1="12" x2="12" y1="18" y2="18" /></>,
                Loader2: <path d="M21 12a9 9 0 1 1-6.219-8.56" />,
                Settings: <><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" /></>
            };

            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill={fill}
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                >
                    {icons[name] || null}
                </svg>
            );
        };

        // --- CONFIG ---
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const appId = typeof window.__app_id !== 'undefined' ? window.__app_id : 'sunahh-pro';
        const apiKey = ""; // Managed by environment

        const MOODS = [
            { id: 'love', icon: 'üíñ', color: 'from-pink-500 to-rose-600', bg: 'bg-rose-950/20', theme: '#4c0519' },
            { id: 'missing', icon: 'ü•∫', color: 'from-blue-400 to-indigo-600', bg: 'bg-indigo-950/20', theme: '#1e1b4b' },
            { id: 'joy', icon: '‚ú®', color: 'from-amber-300 to-orange-500', bg: 'bg-amber-950/20', theme: '#451a03' },
            { id: 'tired', icon: 'üò¥', color: 'from-purple-400 to-violet-700', bg: 'bg-violet-950/20', theme: '#2e1065' },
            { id: 'angry', icon: 'üí¢', color: 'from-red-500 to-orange-700', bg: 'bg-red-950/20', theme: '#450a0a' },
        ];

        const fetchWithRetry = async (url, options, retries = 5, backoff = 1000) => {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, backoff));
                    return fetchWithRetry(url, options, retries - 1, backoff * 2);
                }
                throw error;
            }
        };

        const pcmToWav = (pcmData, sampleRate) => {
            const buffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(buffer);
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i));
            };
            writeString(0, 'RIFF');
            view.setUint32(4, 32 + pcmData.length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) view.setInt16(44 + i * 2, pcmData[i], true);
            return new Blob([buffer], { type: 'audio/wav' });
        };

        const App = () => {
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);
            const [partner, setPartner] = useState(null);
            const [messages, setMessages] = useState([]);
            const [dreams, setDreams] = useState([]);
            const [view, setView] = useState('home'); 
            const [isPressing, setIsPressing] = useState(false);
            const [inputMsg, setInputMsg] = useState('');
            const [dreamPrompt, setDreamPrompt] = useState('');
            const [isGeneratingDream, setIsGeneratingDream] = useState(false);
            const [isEnhancing, setIsEnhancing] = useState(false);
            const [myMood, setMyMood] = useState('love');
            const [isPlayingAudio, setIsPlayingAudio] = useState(null);
            const [showInstallTip, setShowInstallTip] = useState(false);

            const myId = useMemo(() => {
                const hash = window.location.hash.replace('#', '').toLowerCase();
                return hash === 'abhishek' ? 'abhishek' : 'sana';
            }, []);
            const partnerId = myId === 'abhishek' ? 'sana' : 'abhishek';

            // --- INIT FIREBASE ---
            useEffect(() => {
                const checkFirebase = setInterval(() => {
                    if (window.fb) {
                        clearInterval(checkFirebase);
                        startApp();
                    }
                }, 100);

                const startApp = async () => {
                    const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore } = window.fb;
                    try {
                        const app = initializeApp(firebaseConfig);
                        const auth = getAuth(app);
                        
                        if (window.__initial_auth_token) {
                            await signInWithCustomToken(auth, window.__initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                        
                        onAuthStateChanged(auth, setUser);
                        
                        const isStandalone = window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches;
                        if (!isStandalone) setShowInstallTip(true);
                        
                        setTimeout(() => setLoading(false), 1500);
                    } catch (err) {
                        console.error("Firebase init failed", err);
                        setLoading(false);
                    }
                };
            }, []);

            // --- DATA SYNC ---
            useEffect(() => {
                if (!user || !window.fb) return;
                const { doc, setDoc, onSnapshot, collection, query, orderBy, serverTimestamp, getFirestore } = window.fb;
                const db = getFirestore();

                const unsubPartner = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'presence', partnerId), (d) => setPartner(d.data()));
                
                const qMsg = query(collection(db, 'artifacts', appId, 'public', 'data', 'messages'), orderBy('timestamp', 'desc'));
                const unsubMsgs = onSnapshot(qMsg, (snap) => setMessages(snap.docs.map(d => ({ id: d.id, ...d.data() })).reverse()));

                const qDreams = query(collection(db, 'artifacts', appId, 'public', 'data', 'dreams'), orderBy('timestamp', 'desc'));
                const unsubDreams = onSnapshot(qDreams, (snap) => setDreams(snap.docs.map(d => ({ id: d.id, ...d.data() }))));

                const interval = setInterval(() => {
                    setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'presence', myId), {
                        uid: user.uid, lastSeen: serverTimestamp(), isPressing, mood: myMood, id: myId
                    }, { merge: true });
                }, 5000);

                return () => { unsubPartner(); unsubMsgs(); unsubDreams(); clearInterval(interval); };
            }, [user, isPressing, myMood]);

            // --- ACTIONS ---
            const handleSendMessage = async () => {
                if (!inputMsg.trim()) return;
                const text = inputMsg; setInputMsg('');
                const { addDoc, collection, getFirestore, serverTimestamp } = window.fb;
                await addDoc(collection(getFirestore(), 'artifacts', appId, 'public', 'data', 'messages'), {
                    text, sender: myId, timestamp: serverTimestamp()
                });
            };

            const handleEnhanceWhisper = async () => {
                if (!inputMsg.trim()) return;
                setIsEnhancing(true);
                try {
                    const prompt = `Rewrite this romantic message into something poetic and intimate: "${inputMsg}"`;
                    const result = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const enhanced = result.candidates?.[0]?.content?.parts?.[0]?.text?.replace(/["']/g, "").trim();
                    if (enhanced) setInputMsg(enhanced);
                } finally { setIsEnhancing(false); }
            };

            const handleListenToMessage = async (msgId, text) => {
                if (isPlayingAudio === msgId) return;
                setIsPlayingAudio(msgId);
                try {
                    const payload = {
                        contents: [{ parts: [{ text: `Say warmly and intimately: ${text}` }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } }
                        },
                        model: "gemini-2.5-flash-preview-tts"
                    };
                    const result = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const base64Audio = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    if (base64Audio) {
                        const binary = atob(base64Audio);
                        const pcmData = new Int16Array(binary.length / 2);
                        for (let i = 0; i < pcmData.length; i++) pcmData[i] = binary.charCodeAt(i * 2) | (binary.charCodeAt(i * 2 + 1) << 8);
                        const url = URL.createObjectURL(pcmToWav(pcmData, 24000));
                        const audio = new Audio(url);
                        audio.onended = () => setIsPlayingAudio(null);
                        audio.play();
                    }
                } catch(e) { setIsPlayingAudio(null); }
            };

            const handleGenerateDream = async () => {
                if (!dreamPrompt.trim()) return;
                setIsGeneratingDream(true);
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                        method: 'POST',
                        body: JSON.stringify({
                            instances: { prompt: `Cinematic romantic photography of: ${dreamPrompt}` },
                            parameters: { sampleCount: 1 }
                        })
                    });
                    const data = await response.json();
                    const imageUrl = `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                    const { addDoc, collection, getFirestore, serverTimestamp } = window.fb;
                    await addDoc(collection(getFirestore(), 'artifacts', appId, 'public', 'data', 'dreams'), {
                        imageUrl, prompt: dreamPrompt, creator: myId, timestamp: serverTimestamp()
                    });
                    setDreamPrompt('');
                } finally { setIsGeneratingDream(false); }
            };

            const currentMoodData = MOODS.find(m => m.id === (partner?.mood || 'love'));

            if (loading) {
                return (
                    <div className="fixed inset-0 bg-slate-950 flex flex-col items-center justify-center gap-6">
                        <div className="relative">
                            <Icon name="Heart" size={80} className="text-rose-500 animate-pulse" fill="currentColor" />
                        </div>
                        <h1 className="text-3xl font-bold tracking-widest text-white/90">SUNAHH</h1>
                        <p className="text-[10px] text-white/30 uppercase tracking-[0.4em]">Our Private World</p>
                    </div>
                );
            }

            return (
                <div className={`h-screen flex flex-col relative transition-all duration-1000 ${currentMoodData?.bg || 'bg-slate-950'} text-white`}>
                    
                    {/* Background Ambient Glow */}
                    <div className="fixed inset-0 pointer-events-none opacity-30">
                        <div className={`absolute top-[-10%] left-[-10%] w-[60%] h-[60%] blur-[140px] rounded-full bg-gradient-to-br ${currentMoodData?.color || 'from-blue-500 to-purple-500'}`} />
                        <div className="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] blur-[140px] rounded-full bg-gradient-to-tl from-pink-500 to-rose-500" />
                    </div>

                    <header className="relative z-10 px-8 pt-14 flex justify-between items-center shrink-0">
                        <div>
                            <h1 className="text-3xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-white/40 capitalize">
                                {myId === 'abhishek' ? 'Sana' : 'Abhishek'}
                            </h1>
                            <div className="flex items-center gap-2 mt-2">
                                <div className={`w-2 h-2 rounded-full ${partner?.isPressing ? 'bg-green-400 animate-pulse' : 'bg-white/20'}`} />
                                <span className="text-[10px] text-white/40 uppercase tracking-widest">
                                    {partner?.isPressing ? 'Touching you now' : 'Connected'}
                                </span>
                            </div>
                        </div>
                        <button onClick={() => setView('settings')} className="p-3 glass rounded-2xl"><Icon name="Smile" size={22} /></button>
                    </header>

                    <main className="flex-1 relative z-10 overflow-y-auto pb-40 px-6">
                        {view === 'home' && (
                            <div className="h-full flex flex-col items-center justify-center gap-16 view-transition">
                                {showInstallTip && (
                                    <div className="glass p-4 rounded-2xl flex items-center gap-4 text-[11px]">
                                        <Icon name="Smartphone" className="text-amber-300" size={24} />
                                        <p>Tap your browser menu and <strong>"Add to Home Screen"</strong> for the full app experience.</p>
                                    </div>
                                )}
                                <div className="relative">
                                    {isPressing && <div className="absolute inset-0 animate-ping rounded-full bg-white/10 scale-150" />}
                                    <button
                                        onMouseDown={() => setIsPressing(true)}
                                        onMouseUp={() => setIsPressing(false)}
                                        onTouchStart={() => setIsPressing(true)}
                                        onTouchEnd={() => setIsPressing(false)}
                                        className={`relative w-72 h-72 rounded-full glass flex items-center justify-center transition-all ${isPressing || partner?.isPressing ? 'animate-heart' : ''}`}
                                    >
                                        <Icon name="Heart" size={100} fill={(isPressing || partner?.isPressing) ? 'currentColor' : 'none'} className={isPressing || partner?.isPressing ? 'text-rose-400' : 'text-white/10'} />
                                        <div className="absolute -top-4 -right-2 text-5xl">{partner?.mood ? MOODS.find(m => m.id === partner.mood)?.icon : '‚ù§Ô∏è'}</div>
                                    </button>
                                </div>
                                <div className="grid grid-cols-2 gap-4 w-full max-w-sm">
                                    <div className="glass p-5 rounded-[2rem] flex items-center gap-4">
                                        <Icon name="Clock" className="text-blue-400" size={20} />
                                        <div className="text-sm font-semibold">{new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                                    </div>
                                    <div className="glass p-5 rounded-[2rem] flex items-center gap-4">
                                        <Icon name="MapPin" className="text-rose-400" size={20} />
                                        <div className="text-sm font-semibold">Forever</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'chat' && (
                            <div className="flex flex-col h-full pt-4 view-transition">
                                <div className="flex-1 space-y-4 mb-4">
                                    {messages.map(m => (
                                        <div key={m.id} className={`flex flex-col ${m.sender === myId ? 'items-end' : 'items-start'}`}>
                                            <div className={`relative px-4 py-3 rounded-2xl text-[14px] ${m.sender === myId ? 'bg-white text-black rounded-tr-none' : 'glass rounded-tl-none'}`}>
                                                {m.text}
                                                {m.sender !== myId && (
                                                    <button onClick={() => handleListenToMessage(m.id, m.text)} className="absolute -right-8 top-1/2 -translate-y-1/2 text-white/40 hover:text-white">
                                                        <Icon name="Volume2" size={16} />
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="sticky bottom-0 pb-6">
                                    <div className="glass p-2 rounded-full flex items-center gap-2">
                                        <input 
                                            value={inputMsg} onChange={e => setInputMsg(e.target.value)} 
                                            placeholder="Whisper your heart..." 
                                            className="flex-1 bg-transparent px-4 py-2 outline-none text-sm placeholder:text-white/30"
                                        />
                                        <button onClick={handleEnhanceWhisper} className="p-2 text-amber-300 transition-all hover:scale-110 active:scale-90">
                                            {isEnhancing ? <Icon name="Loader2" className="animate-spin" size={18} /> : <Icon name="Wand2" size={18} />}
                                        </button>
                                        <button onClick={handleSendMessage} className="bg-white text-black p-2 rounded-full active:scale-90 transition-all">
                                            <Icon name="Send" size={18} />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'dreams' && (
                            <div className="space-y-8 pt-6 view-transition">
                                <div className="glass p-8 rounded-[2.5rem] space-y-6">
                                    <h2 className="text-xl font-bold flex items-center gap-3"><Icon name="Sparkles" className="text-amber-300" size={24} /> Dream Together</h2>
                                    <textarea 
                                        value={dreamPrompt} onChange={e => setDreamPrompt(e.target.value)}
                                        placeholder="Us having dinner by the stars..."
                                        className="w-full bg-white/5 rounded-2xl p-4 text-sm border border-white/10 h-24 outline-none resize-none"
                                    />
                                    <button onClick={handleGenerateDream} disabled={isGeneratingDream} className="w-full bg-white text-black font-bold py-4 rounded-2xl disabled:opacity-50">
                                        {isGeneratingDream ? 'Painting...' : 'Generate Moment'}
                                    </button>
                                </div>
                                {dreams.map(d => (
                                    <div key={d.id} className="glass rounded-[2rem] overflow-hidden">
                                        <img src={d.imageUrl} className="w-full aspect-[4/5] object-cover" />
                                        <div className="p-6">
                                            <p className="text-sm italic text-white/70 font-serif mb-4">"{d.prompt}"</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'settings' && (
                            <div className="space-y-10 pt-6 view-transition">
                                <section>
                                    <h3 className="text-[10px] font-bold text-white/30 uppercase tracking-[0.3em] mb-6 px-2">How are you feeling?</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        {MOODS.map(m => (
                                            <button 
                                                key={m.id} onClick={() => setMyMood(m.id)}
                                                className={`flex items-center gap-4 p-5 rounded-[2rem] border transition-all ${myMood === m.id ? 'bg-white text-black' : 'glass'}`}
                                            >
                                                <span className="text-2xl">{m.icon}</span>
                                                <span className="text-sm font-bold capitalize">{m.id}</span>
                                            </button>
                                        ))}
                                    </div>
                                </section>
                                <section className="p-8 rounded-[2.5rem] border border-rose-500/20 bg-rose-500/5">
                                    <h3 className="font-bold text-rose-400 mb-2">Private Access</h3>
                                    <p className="text-xs text-rose-300/60 mb-6">Identity: <strong className="uppercase tracking-widest">{myId}</strong></p>
                                    <button onClick={() => window.location.hash = myId === 'abhishek' ? 'sana' : 'abhishek'} className="w-full py-4 glass text-xs font-bold uppercase tracking-widest rounded-2xl text-rose-200">Switch Identity</button>
                                </section>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-10 left-1/2 -translate-x-1/2 glass p-2 rounded-full flex gap-2 z-50">
                        <button onClick={() => setView('home')} className={`p-5 rounded-full transition-all ${view === 'home' ? 'bg-white text-black scale-110' : 'text-white'}`}><Icon name="Heart" size={22} fill={view === 'home' ? 'currentColor' : 'none'} /></button>
                        <button onClick={() => setView('chat')} className={`p-5 rounded-full transition-all ${view === 'chat' ? 'bg-white text-black scale-110' : 'text-white'}`}><Icon name="MessageCircle" size={22} /></button>
                        <button onClick={() => setView('dreams')} className={`p-5 rounded-full transition-all ${view === 'dreams' ? 'bg-white text-black scale-110' : 'text-white'}`}><Icon name="Cloud" size={22} /></button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>